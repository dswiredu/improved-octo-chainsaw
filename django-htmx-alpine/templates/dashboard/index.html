{% extends "base.html" %}
{% load humanize %}

{% block title %}Stock Price Analytics{% endblock %}

{% block content %}
<div class="p-2 bg-gray-100 min-h-screen">
    <div class="flex justify-between items-center">
        <h1 class="text-2xl font-semibold text-gray-500">Overview</h1>
        {% include "partials/_datepicker.html" %}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
        {% include "dashboard/partials/summary_cards.html" %}
    </div>

    <div class="bg-white p-4 shadow-md rounded-lg transform transition duration-500 ease-out opacity-0 translate-y-4 mb-6"
        x-init="setTimeout(() => $el.classList.remove('opacity-0', 'translate-y-4'), 500)"
    >   
        <!-- Graph Controls -->
        <div class="flex justify-between items-start mb-4 px-2" x-data="{ showMenu: false }">
            <!-- Left: Metric Selector -->
            <div class="flex flex-col">
                <label for="metric-select" class="text-sm font-semibold text-gray-600 mb-1">Metric</label>
                <div class="relative">
                    <select id="metric-select" name="metric" class="appearance-none bg-white border border-gray-300 text-gray-800 py-2 px-4 pr-8 rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                        hx-get={% url "update_chart" %}
                        hx-trigger="change",
                        hx-target="#line-chart-container"
                        hx-swap="innerHTML"
                        hx-include="#threshold-select, #period-select"
                    >
                        <option value="close_price" selected>Close Price</option>
                        <option value="high_price">High Price</option>
                        <option value="open_price">Open Price</option>
                        <option value="volume">Volume</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-2 flex items-center text-gray-600">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>

            <!-- Right: Threshold, Periodicity & Menu -->
            <div class="flex items-end space-x-6">
                <!-- Crash Threshold -->
                <div class="flex flex-col">
                    <label for="threshold-select" class="text-sm font-semibold text-gray-600 mb-1">Crash Threshold</label>
                    <select id="threshold-select" name="threshold" class="bg-white border border-gray-300 text-gray-800 py-2 px-4 rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-20">
                        <option selected>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                    </select>
                </div>
                <!-- Periodicity -->
                <div class="flex flex-col">
                    <label for="period-select" class="text-sm font-semibold text-gray-600 mb-1">Periodicity</label>
                    <div class="relative">
                        <select id="period-select" name="period" class="appearance-none bg-white border border-gray-300 text-gray-800 py-2 px-4 pr-8 rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option selected>Daily</option>
                            <option>Monthly</option>
                            <option>Quarterly</option>
                            <option>Annually</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-2 flex items-center text-gray-600">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>

                <!-- 3â€‘dot Menu -->
                <div class="relative pt-6">
                    <button @click="showMenu = !showMenu" class="text-gray-600 hover:text-gray-900 focus:outline-none">
                        <i class="fas fa-ellipsis-v text-2xl font-bold"></i>
                    </button>
                    <div 
                        x-show="showMenu" 
                        @click.away="showMenu = false"
                        x-transition
                        class="absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded shadow-md z-50"
                    >
                        <ul class="text-sm text-gray-800">
                            <li>
                                <button class="w-full text-left px-4 py-2 hover:bg-gray-100">Export Data as Excel</button>
                            </li>
                            <li>
                                <button class="w-full text-left px-4 py-2 hover:bg-gray-100">Show Graph as Table</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="line-chart-container" class="min-h-[500px] opacity-100 transition-opacity duration-500">
            {{ line_chart|safe }}
        </div>            
    </div>

</div>
{% endblock %}
